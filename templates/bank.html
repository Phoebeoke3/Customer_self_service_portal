{% extends "base.html" %}

{% block title %}myBank - SwissAxa Portal{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-university"></i> myBank
        </h1>
        <p class="text-muted">Connect your bank account and initiate transactions. Note: Loans and overdrafts are not available through this channel.</p>
    </div>
</div>

<div class="row g-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Connected Banks</h5>
            </div>
            <div class="card-body">
                {% if bank_accounts %}
                    <div class="list-group">
                        {% for account in bank_accounts %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">
                                    <i class="fas fa-university"></i> {{ account.bank_name }}
                                </h6>
                                <small class="text-muted">Account: ****{{ account.account_number[-4:] if account.account_number else 'N/A' }}</small>
                            </div>
                            <span class="badge bg-{{ 'success' if account.is_connected else 'secondary' }}">
                                {{ 'Connected' if account.is_connected else 'Disconnected' }}
                            </span>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted">No bank accounts connected.</p>
                {% endif %}
                <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#connectBankModal">
                    <i class="fas fa-plus"></i> Connect Bank
                </button>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Initiate Transaction</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('bank_transaction') }}">
                    <div class="mb-3">
                        <label for="bank_name" class="form-label">Select Bank</label>
                        <select class="form-select" id="bank_name" name="bank_name" required>
                            <option value="">Select a bank...</option>
                            <option value="Sparkasse">Sparkasse</option>
                            <option value="N26">N26</option>
                            <option value="Deutsche Bank">Deutsche Bank</option>
                            <option value="Commerzbank">Commerzbank</option>
                            <option value="Volksbank">Volksbank</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="transaction_type" class="form-label">Transaction Type</label>
                        <select class="form-select" id="transaction_type" name="transaction_type" required>
                            <option value="debit">Debit</option>
                            <option value="credit">Credit</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="amount" class="form-label">Amount (EUR)</label>
                        <input type="number" step="0.01" class="form-control" id="amount" name="amount" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description (Optional)</label>
                        <input type="text" class="form-control" id="description" name="description">
                    </div>
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-exchange-alt"></i> Process Transaction
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Connect Bank Modal -->
<div class="modal fade" id="connectBankModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Connect Bank Account</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('connect_bank') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="bank_name_connect" class="form-label">Bank Name</label>
                        <select class="form-select" id="bank_name_connect" name="bank_name" required>
                            <option value="">Select a bank...</option>
                            <option value="Sparkasse">Sparkasse</option>
                            <option value="N26">N26</option>
                            <option value="Deutsche Bank">Deutsche Bank</option>
                            <option value="Commerzbank">Commerzbank</option>
                            <option value="Volksbank">Volksbank</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="account_number" class="form-label">Account Number</label>
                        <input type="text" class="form-control" id="account_number" name="account_number" required>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> This will redirect you to your bank's mobile app for secure authentication.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-link"></i> Connect
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

